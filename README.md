# HPSS Transfer Sorted Files

```
usage: hpss_transfer_sorted_files.py [-h] [-D] [-C CACHE_PATH] [-l] [-p] [-c] [-a ADDITIONAL_HSI_FLAGS] [-e] [-f PRESERVED_FILES_PATH] [-v] source destination

NOTE: While this script will work with PASSCODE auth, it is HIGHLY recommended to use standard 'keytab' auth (e.g. do not use --additional-hsi-flags unless you absolutely must!

positional arguments:
  source                Top level directory in HPSS to pull files from. This is a recursive action!
  destination           Top level directory on Kronos to put files. An identical directory structure will be created here as exists in HPSS under `source`

optional arguments:
  -h, --help            show this help message and exit
  -D, --dry-run         Generate the file lists but do not actually checksum or transfer files, and output the `hsi` commands that would have been used
  -C CACHE_PATH, --cache-path CACHE_PATH
                        Path to existing cache generated by --preserve-cache, or from an interrupted job. Picks up where the last job left off
  -l, --preserve-file-lists
                        Do not delete the file list generated by this script. Will write the list to the cwd or the value of --preserved-files-path
  -p, --preserve-cache  Do not delete the db cache. This can be useful for restarting an interrupted migration
  -c, --disable-checksums
                        Disable the checksumming operation. This can speed things up, but at the cost of not verifying data integrity on the destination
  -a ADDITIONAL_HSI_FLAGS, --additional-hsi-flags ADDITIONAL_HSI_FLAGS
                        Additional flags needed to be passed to `hsi`
  -e, --overwrite-existing
                        Force overwrite of existing files that match the file names in HPSS
  -f PRESERVED_FILES_PATH, --preserved-files-path PRESERVED_FILES_PATH
                        Sets the path that the transfer report and/or database/file list are written to. This can be useful if the DB and resulting files lists/transfer report are too large for your current working directory
  -v, --verbose         Output additional information about the transfer
```

Additional hidden flags:

```
--vvs-per-job=1 Batches up multiple VVs into a single HSI job. Set to -1 to put ALL files into a single HSI job
--checksum-threads=4 Launches more threads in the destination checksumming worker pool
--disable-ta Launches the HSI get with -T off
--debug Enables a higher level of debug output. Mainly implies --verbose + echo=True for sqlalchemy
--db-tx-size/-s Sets the DB_TX_SIZE. This dictates the size of batched DB transactions, as well as the 'chunk size' of lines to cache from HSI
--trace/-t Enables memory tracing
```

To run:
```
$ make
$ ./hpss_transfer_sorted_files_dev ... # Runs against the hpss_transfer_sorted_files.py in your current working directory
$ ./hpss_transfer_sorted_files ... # Runs agains the script in /sw/sources/hpss/bin
```
